public with sharing class projectYearlyMonth_ba2 implements Database.Batchable<SObject> {
    
    public Database.QueryLocator start(Database.BatchableContext bc) {
        String ProjectId = 'a2TF7000002N7dQMAS';
        String query = 'SELECT Id, ru_Budget__c, Name, '+
                        'StartDate__c, EndDate__c, ru_Amount__c, fm_NetAmount__c ' +
                       'FROM Project__c WHERE ru_Budget__c != 0 and id=: ProjectId';

        System.debug('start() ì‹¤í–‰ë¨. Query: ' + query);

        List<Project__c> listProject = Database.query(query);
        System.debug('ğŸ“Š [start] ì¡°íšŒëœ ë ˆì½”ë“œ ê°œìˆ˜: ' + listProject.size());

        if(!listProject.isEmpty()){
            for(Project__c project: listProject){
                Date startDate=project.StartDate__c;
                Date endDate=project.EndDate__c;

                //í”„ë¡œì íŠ¸ ì‹œì‘ë…„ë„ì™€ ì¢…ë£Œë…„ë„ ê°€ì ¸ì˜¤ê¸°
                Integer startYear = startDate.year();
                System.debug('startYear: '+startYear);
                Integer endYear = endDate.year();
                System.debug('endYear: '+endYear);
                //í”„ë¡œì íŠ¸ ì‹œì‘ì›”ê³¼ ì¢…ë£Œì›” ê°€ì ¸ì˜¤ê¸°
                Integer startMonth=startDate.month();
                System.debug('startMonth: '+startMonth);
                Integer endMonth=endDate.month();
                System.debug('endMonth: '+endMonth);
                //í”„ë¡œì íŠ¸ ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì¼ ê°€ì ¸ì˜¤ê¸°
                Integer startDay=startDate.day();
                System.debug('startDay: '+startDay);
                Integer endDay=endDate.day();
                System.debug('endDay: '+endDay);
                //ë‘ ë‚ ì§œê°„ì˜ ì¼ì°¨ì´ ê°€ì ¸ì˜¤ê¸°
                Integer dayDiff=startDate.daysBetween(endDate);
                System.debug('dayDiff: '+dayDiff);
                //í”„ë¡œì íŠ¸ì— í• ë‹¹ ëœ ì˜ˆì‚° ê°€ì ¸ì˜¤ê¸°
                Decimal decproject=project.ru_Budget__c;
                System.debug('decproject: '+decproject);
                
                Decimal dayByproject=decproject/Decimal.valueOf(dayDiff); //ì¼ë³„ ì˜ˆì‚°
                System.debug('dayByproject: '+dayByproject);

                //í•„ë“œë¥¼ ëª‡ê°œ ë§Œë“¤ì–´ì•¼ í• ì§€ ë¹„êµ í›„ ìƒì„±(ì˜ˆì‚°)
                List<YearlyAmount__c> listYearlyAmount=new List<YearlyAmount__c>();
                for(Integer year=startYear;year<=endYear;year++){
                    yearlyAmount__c objYearlyAmount=new yearlyAmount__c();
                    //objYearlyAmount.project__c=project.id; //ì˜ˆì‚°
                    //System.debug('1. : '+objYearlyAmount.project__c);
                    objYearlyAmount.Type__c='ì˜ˆì‚°';//íƒ€ì…: ì˜ˆì‚°
                    System.debug('2. : '+objYearlyAmount.Type__c);
                    objYearlyAmount.Project__c=project.id; //í”„ë¡œì íŠ¸
                    System.debug('3. : '+objYearlyAmount.Project__c);
                    objYearlyAmount.Year__c=String.valueOf(year); //ë…„ë„
                    System.debug('4. : '+objYearlyAmount.Year__c);
                    objYearlyAmount.Name=String.valueOf(year)+'ë…„_'+ project.Name + ' ì›”ë³„ì˜ˆì‚°';
                    
                    Integer firstMonth=(year==startYear)? startMonth : 1;
                    Integer lastMonth=(year==endYear)? endMonth: 12;

                    for(Integer month=firstMonth;month<=lastMonth;month++){
                        Integer day=Date.daysInMonth(year, month); //í•´ë‹¹ ë…„ë„ ë‹¬ì˜ ì¼ ìˆ˜ ë°˜í™˜
                        if(year==startYear&& month==startMonth){
                            day=day-startDay+1;
                        }
                        else if(year==endYear && month==endMonth){
                            day=endDay;
                        }
                        
                        System.debug('day: '+day);
                        //ì˜ˆì‚° ê³„ì‚°
                        
                        Decimal monthproject = dayByproject * Decimal.valueOf(day);
                        System.debug('monthproject: '+monthproject);
                        String monthFieldName='month'+ String.valueOf(month) +'__c';
                        System.debug('monthFieldName: '+monthFieldName);
                        
                        objYearlyAmount.put(monthFieldName,monthproject);
                    }
                    System.debug('objYearlyAmount: '+objYearlyAmount);
                    listYearlyAmount.add(objYearlyAmount);
                }

                System.debug('listYearlyAmount: '+listYearlyAmount);
                insert listYearlyAmount;
            }  
        }
        else{
            System.debug('listProject is Empty');
        }
        
        

        

        return Database.getQueryLocator(query);
    }
    
    public void execute(Database.BatchableContext bc, List<project__c> scope) {
        System.debug('execute() ì‹¤í–‰ë¨. scope size: ' + scope.size());
        
        for (project__c b : scope) {
            System.debug('Processing project__c record: ' + b);
        }
    }
    
    public void finish(Database.BatchableContext bc) {
        System.debug('finish() ì‹¤í–‰ë¨. ë°°ì¹˜ ì™„ë£Œ');
    }
}